<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Column Display with Count and Percentage (Average)</title>
    <link rel="stylesheet" href="style/weeklygoals.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <nav style="text-align: center; margin: 20px 0;">
        <ul style="list-style-type: none; padding: 0; display: inline-flex; gap: 40px;">
            <li>
                <a href="index.html"  style="text-decoration: none; color: #0056b3; font-weight: bold; font-size: 18px; padding: 10px 20px; border: 2px solid #0056b3; border-radius: 5px; transition: all 0.3s;">
                    Dashboard
                </a>
            </li>
            <li>
                <a href="/Po.html"  style="text-decoration: none; color: #0056b3; font-weight: bold; font-size: 18px; padding: 10px 20px; border: 2px solid #0056b3; border-radius: 5px; transition: all 0.3s;">
                    PO Percentage by Counter Person
                </a>
            </li>
             <li>
                <a href="/So.html"  style="text-decoration: none; color: #0056b3; font-weight: bold; font-size: 18px; padding: 10px 20px; border: 2px solid #0056b3; border-radius: 5px; transition: all 0.3s;">
                  SO Percentage by Counter Person
                </a>
            </li>
        </ul>
    </nav>

    <!-- --- Google Sheets Sign In --- -->
    <button id="authorize_button" style="margin: 18px 0 8px 0; font-size: 1.1em;">Sign in to View Google Sheet</button>
    <button id="signout_button" style="display:none;margin-left:12px;font-size:1.1em;">Sign out</button>
<button id="refresh_button" style="display:none;margin-left:12px;font-size:1.1em;">Refresh Data</button>

    <h1>Weekly Goals</h1>
    <div class="download-info" id="csvDate"></div>
  
    <div id="dropZone">
      <p>Drag and drop your CSV file here or</p>
      <label for="csvFileInput" style="color: #0044cc; cursor: pointer; text-decoration: underline;">click</label>
      to upload.
      <input type="file" id="csvFileInput" style="display: none;" accept=".csv" />
    </div>
    <div id="table-container"></div>

    <div class="loading-bar-overlay" id="loadingBarOverlay" style="display: none;">
      <div class="loading-bar-container" id="loadingBarContainer">
        <div class="loading-bar" id="loadingBar"></div>
      </div>
    </div>

    <button id="copy-today-column-btn" style="display:none;position:fixed;bottom:32px;right:32px;z-index:9999;">Copy 7/21 Column Values</button>

    <!-- Google API and GIS for Sheets -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
    // --- GOOGLE SHEETS + GIS SIGNIN LOGIC ---
    const CLIENT_ID = "518347118969-drq9o3vr7auf78l16qcteor9ng4nv7qd.apps.googleusercontent.com";
    const API_KEY = "AIzaSyBGYsHkTEvE9eSYo9mFCUIecMcQtT8f0hg";
    const SHEET_ID = "1-odgue-k8jX-QbnTvi-7_jUK4O2Q---ZnMzuuBfKYdE";
    const SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;
function updateSigninStatus(isSignedIn) {
  document.getElementById('authorize_button').style.display = isSignedIn ? 'none' : 'block';
  document.getElementById('signout_button').style.display = isSignedIn ? 'inline-block' : 'none';
  document.getElementById('refresh_button').style.display = isSignedIn ? 'inline-block' : 'none';
  document.getElementById('table-container').style.display = isSignedIn ? 'block' : 'none';

  if (isSignedIn) {
    listSheetData();
  } else {
    document.getElementById('table-container').innerHTML = "";
  }
}
document.getElementById('refresh_button').onclick = listSheetData;

    function gapiLoaded() {
      gapi.load('client', async () => {
        await gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
        });
        gapiInited = true;
        maybeEnableButtons();
      });
    }
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: async (tokenResponse) => {
          if (tokenResponse.error) {
            alert(JSON.stringify(tokenResponse, null, 2));
            return;
          }
          document.getElementById('authorize_button').style.display = 'none';
          document.getElementById('signout_button').style.display = 'inline-block';
          await listSheetData();
        },
      });
      gisInited = true;
      maybeEnableButtons();
    }
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        document.getElementById('authorize_button').onclick = () => tokenClient.requestAccessToken();
        document.getElementById('signout_button').onclick = () => {
          google.accounts.oauth2.revoke(tokenClient.clientId, () => {
            document.getElementById('authorize_button').style.display = 'inline-block';
            document.getElementById('signout_button').style.display = 'none';
            document.getElementById('table-container').innerHTML = "";
          });
        };
      }
    }
    async function listSheetData() {
      const res = await gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SHEET_ID,
        range: 'Sheet1!A1:Z100',
      });
      const rows = res.result.values;
      let html = "<table border='1'><tbody>";
      rows.forEach(row => {
        html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join('') + "</tr>";
      });
      html += "</tbody></table>";
      document.getElementById('table-container').innerHTML = html;
    }
    window.gapiLoaded = gapiLoaded;
    window.gisLoaded = gisLoaded;
    </script>
    <!-- these onload hooks are required for safe init order -->
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
    <!-- your existing scripts still load below -->
    <script src="js/config.js"></script>
    <script type="module" src="js/weeklygoals.js"></script>
    <script>
      window.env = {
        AIRTABLE_API_KEY: 'patXTUS9m8os14OO1.6a81b7bc4dd88871072fe71f28b568070cc79035bc988de3d4228d52239c8238',
        AIRTABLE_BASE_ID: 'appO21PVRA4Qa087I',
        AIRTABLE_TABLE_NAME: 'tbl6EeKPsNuEvt5yJ',
        AIRTABLE_TABLE_NAME2: 'tbl9SgC5wUi2TQuF7',
      };
    </script>
</body>
